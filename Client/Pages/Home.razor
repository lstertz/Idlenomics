@page "/"
@using Microsoft.AspNetCore.SignalR.Client
@using Shared.Features

<PageTitle>Idlenomics</PageTitle>

<div class="centered">
    @if (!@hasStarted)
    {
        <button class="btn btn-primary" @onclick="Start">Start</button>
    }
    else
    {
        <p role="status">Idlenomics coming soon!</p>
    }
</div>

@code {
    private bool hasStarted;

    private async Task Start()
    {
        HubConnection hubConnection = new HubConnectionBuilder()
            .WithUrl(new Uri("https://localhost:7285/clientHub"))
            .Build();

        hubConnection.On<OnFeaturesUpdatedNotification>("OnFeaturesUpdated", notification =>
        {
            Console.WriteLine("Received updated features: ");
            foreach (var feature in notification.Features)
                Console.WriteLine($"Feature: {feature.Name}");
        });

        try
        {
            await hubConnection.StartAsync();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
        }

        hasStarted = true;
    }
}
